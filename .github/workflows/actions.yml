name: Github CI

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      
      - name: Check out repository code
        uses: actions/checkout@v5
      
      - name: Setup Miniconda
        uses: conda-incubator/setup-miniconda@v3
        with:
          auto-update-conda: true
          python-version: "3.10"
          channels: conda-forge,bioconda,defaults
          channel-priority: flexible
      
      - name: Install conda dependencies
        shell: bash -l {0}
        run: |
          conda install -y -c bioconda salmon alevin-fry
          conda install -y -c conda-forge scanpy pyroe
      
      - name: Install Python dependencies
        shell: bash -l {0}
        run: |
          python -m pip install --upgrade pip
          pip install jupyter nbconvert nbclient ipykernel
          pip install anndata==0.11.4 biopython==1.86 celltypist==1.7.1
          pip install numpy==1.23.0 pandas==1.5.3 scipy==1.13.1
          pip install scikit-learn==1.7.2 matplotlib==3.10.8 seaborn==0.13.2
          pip install leidenalg==0.11.0 igraph==1.0.0 umap-learn==0.5.9.post2
          pip install h5py==3.15.1 networkx==3.4 tqdm==4.67.1
          pip install mygene==3.2.2 biothings_client==0.4.1
      
      - name: Register IPython kernel as 'scrna'
        shell: bash -l {0}
        run: |
          python -m ipykernel install --user --name scrna --display-name "Python (scrna)"
          jupyter kernelspec list
      
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      
      - name: Week 6
        shell: bash -l {0}
        run: jupyter execute week6/code/week6.ipynb --inplace